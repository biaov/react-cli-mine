"use strict";var __awaiter=this&&this.__awaiter||function(e,i,s,c){return new(s=s||Promise)(function(t,r){function n(e){try{a(c.next(e))}catch(e){r(e)}}function o(e){try{a(c.throw(e))}catch(e){r(e)}}function a(e){var r;e.done?t(e.value):((r=e.value)instanceof s?r:new s(function(e){e(r)})).then(n,o)}a((c=c.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(t,n){var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:r(0),throw:r(1),return:r(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=n.call(t,s)}catch(e){r=[6,e],a=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;for(var n=Array(e),o=0,r=0;r<t;r++)for(var a=arguments[r],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var commander_1=require("commander"),inquirer_1=require("inquirer"),chalk_1=require("chalk"),ora_1=__importDefault(require("ora")),download_git_repo_1=__importDefault(require("download-git-repo")),execa_1=__importDefault(require("execa")),fs_1=require("fs"),log_1=__importDefault(require("@/utils/log")),variables_1=require("@/utils/variables"),function_1=require("@/utils/function"),package_json_1=require("@/../package.json"),iconError=log_1.default.iconError,iconSuccess=log_1.default.iconSuccess,success=log_1.default.success,info=log_1.default.info,error=log_1.default.error,warning=log_1.default.warning;exports.Create=function(t){void 0===t&&(t="");var n=function_1.GetPresetInfo(),e=function_1.FormatePreset(n);inquirer_1.prompt([{type:"input",name:"projectName",message:"你的项目叫什么名称？",default:t,validate:function(e){if(e||t){var r=process.cwd()+"\\"+(e||t);return!fs_1.existsSync(r)||(warning("项目名称已存在"),!1)}return warning("项目名称不能为空"),!1}},{type:"list",name:"preset",message:"请选择预设：",choices:__spreadArrays(e,["默认预设（"+chalk_1.yellow("React-Router-Dom")+"，"+chalk_1.yellow("Redux/React-Redux/React-Thunk")+"，"+chalk_1.yellow("Axios")+"，"+chalk_1.yellow("Antd")+"，"+chalk_1.yellow("Less")+"）推荐","自义定预设"])}]).then(function(e){var o=e.projectName,r=e.preset;"自义定预设"===r?inquirer_1.prompt([{type:"checkbox",name:"customPreset",message:"在你的项目中需要什么？",default:["CSS Pre-processors"],choices:["React-Router-Dom","Redux/React-Redux/React-thunk","Axios","Antd","CSS Pre-processors",new inquirer_1.Separator(chalk_1.yellow("（目前只支持选择 CSS 预编译器，其它的暂不支持选择，如果要支持的话，有31种组合方式，暂无解决方案）"))]}]).then(function(e){var n=e.customPreset;return __awaiter(void 0,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return-1===(r=n.indexOf("CSS Pre-processors"))?[3,2]:[4,inquirer_1.prompt([{type:"list",name:"cssPrePro",message:"选择 CSS 预编译器（PostCSS, Autoprefixer 和 CSS Modules 是默认的）",choices:variables_1.cssPres}])];case 1:t=e.sent().cssPrePro,n.splice(r,1,t),e.label=2;case 2:return inquirer_1.prompt([{type:"confirm",name:"isSave",message:"是否要保存你的预设？"}]).then(function(e){var t=e.isSave;return __awaiter(void 0,void 0,void 0,function(){var r;return __generator(this,function(e){switch(e.label){case 0:return t?[4,inquirer_1.prompt([{type:"input",name:"presetName",message:"自定义预设叫什么名称？",validate:function(e){return!!e||(warning("请输入自定义预设名称"),!1)}}])]:[3,2];case 1:r=e.sent().presetName,function_1.SavePresetInfo(r,n),e.label=2;case 2:return exports.DownLibrary(n,o),[2]}})})}),[2]}})})}):r.includes("默认预设")?exports.DownLibrary([],o):exports.DownLibrary(Object.values(n)[0],o)})},exports.Arguments=function(e,r){error("`rcm "+e+(r?" "+r:"")+"` 命令不存在"),commander_1.program.help()},exports.DownLibrary=function(r,a){var i=process.cwd()+"\\"+a;info(),info(chalk_1.blueBright("React Cli Mine v"+package_json_1.version)),info(),info(chalk_1.yellow(">>")+" 在此目录下创建项目："+chalk_1.yellow(i));var s=ora_1.default({text:"正在下载模板中...",color:"yellow"});s.start();var t="",t=0<r.length?(variables_1.cssPres.forEach(function(e){r.includes(e)&&(t=e.toLowerCase())}),t?"less"===t?"master":t:"css"):"master";download_git_repo_1.default("direct:"+variables_1.templateDown+"#"+t,i,{clone:!0},function(o){return __awaiter(void 0,void 0,void 0,function(){var r,t,n;return __generator(this,function(e){switch(e.label){case 0:return o?(s.fail(),info(iconError+chalk_1.red(o)),[3,3]):[3,1];case 1:return r=i+"\\package.json",fs_1.existsSync(r)&&((t=JSON.parse(fs_1.readFileSync(r).toString())).name=a,fs_1.writeFileSync(r,JSON.stringify(t))),s.succeed("模板下载成功"),info(chalk_1.yellow(">>")+" 正在安装依赖插件，可能要等一会..."),[4,execa_1.default("npm",["install","--loglevel","error"],{cwd:i,stdio:"inherit"})];case 2:n=e.sent().stdout,s.succeed("依赖插件安装成功"),info(n),success(iconSuccess+" 项目初始化完成"),info(),info(chalk_1.yellow("$")+"  "+chalk_1.cyanBright("cd "+a)+"    进入项目目录"),info(chalk_1.yellow("$")+"  "+chalk_1.cyanBright("npm start")+"    运行项目"),info(),e.label=3;case 3:return[2]}})})})};